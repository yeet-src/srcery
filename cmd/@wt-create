#!/usr/bin/env srcery-bash
set -euo pipefail

repo="${1:?usage: @wt-create REPO}"
repo_path="$YEET_SRC_ROOT/$repo"

[[ -d "$repo_path/.git" ]] || die "$repo_path is not a git repo"

id=$(head -c4 /dev/urandom | xxd -p)
name="wt_${id}_${repo}"
wt_path="$SRCERY_ROOT/data/worktrees/$name"

mkdir -p data/worktrees
git -C "$repo_path" worktree add "$wt_path" -b "wt_${id}"

echo "$wt_path"
