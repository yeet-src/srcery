#!/usr/bin/env srcery-bash

[[ -d "$SRCERY_DATA/worktrees" ]] || exit 0

filter="${1:-}"

for wt in "$SRCERY_DATA"/worktrees/*/; do
	[[ -d "$wt" ]] || continue
	name="${wt%/}"
	name="${name##*/}"

	if [[ -n "$filter" ]]; then
		# derive repo from worktree's .git file
		gitdir=$(<"$wt.git")
		gitdir="${gitdir#gitdir: }"
		repo_path="${gitdir%/.git/worktrees/*}"
		repo="${repo_path##*/}"
		[[ "$repo" == "$filter" ]] || continue
	fi

	echo "$name"
done
